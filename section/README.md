# 模块说明

目前的三大模块分别是番剧, 漫画, 文章, 博客仅支持安卓 APP, 支持批量导入;

## 视频

番剧主要是用来上架一些动画的, 当然后台里叫视频, 理论上可以不限于番剧, 用来做电影网站也行

### 新建

- **标题**: 展示的标题, 搜索也只会搜索标题,使用的是正则匹配, 暂不支持模糊搜索
- **别名**: 这个是前端链接展示的, 方便用户分享复制, 其他没啥太大的意义
- **状态**: 只有审核通过的才会展示出来
- **是否连载**: 前端会自动展示连载中的番剧
- **评分人数**: 目前支持用户打分, 此处分数为初始的打分人数基准, 后续的打分都会在此基础上求平均值
- **平均评分**: 此处分数为初始的打分数值基准, 后续的打分都会在此基础上求平均值
- **更新时间**: 连载中的才有必要, 完结的就不用弄了
- **首播日期**: 详情展示使用
- **推荐评语**: 站长推荐等的展示语, 暂时还没做关联的功能
- **参与声优**: 暂时没有展示, 不过获取的信息里面都有
- **工作人员**: 同上
- **不设置前缀**: 不使用设置里面的等级限定, 在获取播放链接的时候不会加设置里面的前缀, 包括解析,一般都是本身链接比较完整的情况下需要勾选
- **等级限定**: 有用户等级高于或等于此等级的才会显示播放链接, 但是搜索还是能搜索出来的, 所以想要完全屏蔽是不行的
- **播放类型**: 直链指的是能够在 dplayer 直接播放的格式, 仅限于 mp4, m3u8 则是 m3u8 结尾的后缀, 解析则是网址里面的有两个 http 的那种, 除了 mp4 以及 m3u8 能够直接播放, 其他的都是要使用 iframe 或者 webview 嵌入, 这种一般都不能使用 https
- **下载标题**: 在页面上展示一个下载的 button, 这个是所有人都能看的, 没有等级限定, 为空的话会显示暂无下载,四个字母的一般都是百度云密码
- **下载链接**: 下载 Button 的点击链接, 为空则不会跳转
- **链接前缀**: 在设置的前缀后面再加上一层前缀, 减少反复填写的结构, 都是以/开头, 不带/结尾
- **专题**: 同一部番剧的不同季可以加到一个专题里面, 显示的时候会关联出其他的季数, 没有的话则不显示
- **专题名**: 第几季这种名称
- **横向图**: 一般是用来做一些宣传的, 比如说轮播, 首页置顶推荐, 这些都会展示横向图, 也可以直接使用网址链接
- **竖向图**: 正常的显示图片, 基本上必填, 也可以使用网址链接

### 云端搜索

搜索的是本地的资源池数据, 导入的话仅会导入信息, 而不会导入剧集, 最大的功能就是会根据信息的分类自动寻找分类中同名的然后自动匹配, 算是比较实用的一个功能;

### 剧集

- 只有新建完一个视频才能创建剧集
- 序号是排序的标准, 也是更新中的剧集显示的数字, 所以第几集就填写几, 前面的标题填写具体的剧集标题名
- 封面则是显示的剧集图, 不填默认显示视频的图片
- 缩略图是播放器可以滑动预览, 先提前加上字段, 具体的要等播放器这块去修改
- 链接也是做了清晰度的支持, 但是仍需要播放器这块去调整, 暂时填写第一项即可, 理论上的播放链接就是: 后台等级前缀 + 视频链接前缀 + 播放链接
- 字幕暂无播放器支持
- B 站字幕 ID 这个暂时不行, 因为没有做接口的转发

### 分类

- 分类的话目前有地区, 年份, 类型, 以及标签;
- 显示外部则是是否给前端显示用, 一些内部的标签比如说轮播图, 置顶这些就不用展示给外部了, 所以是个筛选的功能

### 专题

- 主要是聚合不同的季数, 这样前端就不会请求所有的季数信息, 我们也可以点击直接跳转到相应的季数, 但是需要后台手动控制
- 后续可能用来做一些活动的专题

## 漫画

针对漫画的格式, 跟视频其实比较类似, 但是不是目前的主要功能, 所以仅仅是能用, app 也没做适配, 聊胜于无

## 新增

- 其他的参考视频即可
- 播放类型, 目前有三种, 本地图库则是直接遍历服务器`/public/picture/`目录下指定的文件夹, 将图片返回给前端而已;图片链接则是需要手动新增图片的地址, 而图片接口则是访问外部的图库接口, 需要一次性返回所有的图片
- 目前这块测试比较少, 暂时自己摸索吧

其他参考视频

## 文章

文章支持 markdown 编辑器, 可上传图片, 所以前后台编辑没啥太大的区别, 一般放点资讯或者公告就行, 想要做成那种登录下载资源的也行, 毕竟有等级限定

### 新增

- **等级限定**: 只有用户等级高于或等于此等级的才会显示内容, 普通用户只能看到标题简介, 点击显示没有权限
- **状态**: 只有审核通过的才会展示出来
- **封面**: 正常的显示图片, 一般都是横向图居多
- **标签**: 以英文逗号分割, 然后点击按钮就能批量添加了, 这个暂时没啥功能
- **标题**: 展示的标题
- **别名**: 这个是唯一索引, 所以最好使用特征性强一点的, 建议别名形式为:pv00001, 最好是纯英文+数字, 中文不保证会出什么问题, 前端也是用这个来展示链接的, 怕被人扫就弄个随机的
- **简介**: 手动填写一下, 主要是外面展示用的一部分信息
- **内容**: 文章主体部分, 图片会上传到自己的服务器上, 可以测试下具体的地址

其他参考视频

## 博客

暂时只有 APP 支持, 类似微博这种, 暂时没有弄好

## 用户

用户等级 >= 100 就是管理员, 可以登录到后台, 拥有全部权限, 这个暂时没有太好的办法, 只能等后续看能不能加上权限控制;

### 基本信息

- **等级**: 用户的实际等级, 0 级为游客, 也就是未注册登录用户,1 级为注册用户, 100 级为管理员, 中间的那些就自由发挥了
- **积分**: 积分主要是根据用户评论等添加一定的积分, 目前暂时没啥作用, 积分获取这些都没做
- **金钱**: 充值使用
- **会员剩余**: 这是用来添加会员有效期的, 单位是秒, 表示过了这段时间后会将等级降为 1, 后台每隔 15 分钟遍历一遍用户表, 所以过期不是实时生效的
- **状态**: 待验证则是表示需要用邮箱验证, 实际上注册了就能用, 验证后续看需求吧, 已删除表示用户提出删除账户的请求

### 批量编辑

- 批量编辑默认会忽略等级 100 的, 也就是管理员, 但是单独编辑的话则不会忽略
- 分类这些不勾选的话代表不修改, 而状态是一定会修改的, 所以要注意
- 批量删除,全部删除都会有弹窗提示, 表格里面的单项删除则不会有提示

## 商品

商品主要售卖的是等级以及会员剩余时间, 可以先设定一个等级系统, 然后根据等级来发布相应的番剧文章等等

### 商品列表

- **价格**: 不用说了, 这个跟充值码的单位一样, 当然你可以在出售充值码的时候设定不同的比例
- **提升等级**: 用户会提升到该等级, 而不是直接添加, 即使用户 99 级, 购买了一个 1 级套餐依旧会变成 1 级
- **添加积分**: 直接相加积分, 不过目前没啥用
- **有效期**: 有效期的话麻烦一点, 低等级的购买高等级套餐会将当前时间清零然后加上套餐时间, 而高等级套餐购买低等级套餐会直接相加有效期
- **状态**: 上架的才会展示出来
- **标题**: 简要的描述
- **商品简介**: 隐藏了等级这些, 所以具体的套餐内容全靠描述, 反正用户也不关心具体等级

### 订单列表

- 主要是用来查询订单记录, 每天看看, 有异常的话也好有个记录
- 用户投诉的话就发个订单号看看有没有添加上去

### 激活码

- 激活码这个可用于充值金额, 随机生成的, 一般不存在重复的情况

## 资源

### 资源列表

- 本地维护的一个资源池, 所有从采集站采集的资源都会先进入到资源池中, 然后可以手动去选择导入更新
- 第一次导入会创建新的信息, 后续更新只会更新剧集信息
- 主要是根据别名来更新本地的, 所以请不要在导入后修改别名

### 来源列表

- 目前仅支持苹果 CMS 的接口, 找到采集站的苹果 CMS 的采集接口然后输入即可
- 分类 ID 这个自己找找就行, 一般动漫的都是 4
- 采集任务开启后, 都在操作记录里面同步, 在那看采集结果即可

### 操作记录

目前记录两种, 一种是采集的操作, 由于无法确认总数, 所以每采集到一部总数就会加 1, 成功+失败 = 总数不一定是采集完成了;

另一种则是资源池导入到本地, 会显示所有的总数然后导入, 如果看到成功+失败 = 总数, 就意味着已经导入完成了

查看日志则是会显示所有的失败的名称或者别名

## 评论

此处则集合所有的评论,根据父子评论集合到了一起, 同时也只会显示审核通过的评论给前端 ,目前前端在这块暂时没有做智能提示;

## 评分

可以让用户手动评分, 具体的评分机制为:假设视频初始评分人数 1000, 初始平均评分为 5, 后续新增一个人评分 8, 那么显示评分为: (1000 \* 5 + 8) / (1000 + 1)
需要各端同步, 暂时没实现前端评分

## 弹幕

弹幕用的是 dplayer 的格式, 理论上来说可以兼容的, 这样省去制作弹幕接口了

## 举报

这个功能其实主要是需要处理下用户的举报, 用户举报完就看不到了, 所以状态啥的主要是表示自己已经处理了

## 图片

这个功能主要是管理用户上传的图片, 会遍历文件夹内的所有图片然后展示, 目前的显示效果有点一般, 后续再优化吧

### 列表

- 里面的分类主要是后台设定的, 相应上传的图片都会到这里面来, 而且你也不知道用户会不会正在使用这张图片, 所以一般不要删除, 除非是一些涉黄的或者严重影响观感的

## 设置

后台的设置项, 这个里面内容比较多, 需要先行设置, 然后每次保存的时候会生成一份配置文件与前端文件放在一起, 所以新站必须要先设置然后保存一次;

### 基本信息

- **主题色**: 仅限于前端 web 的顶栏与底栏, 颜色不要太夸张, 黑色会比较高大上一点, 而移动端都是用的白色背景, 只有一些按钮等小地方才会用到这个主题色, app 则是完全不通用
- **网站名**: 显示在标题栏的名称
- **标语**: 有些地方会用到, 简单一句话即可
- **简介**: 一般是放在底部的
- **QQ 群链接**: 点击跳转加群这种链接, 不是群号
- **邮箱**: 点击发送邮件, 不填写则不跳转
- **APP 下载链接**: 自己填写个地址, 也可以放在 public 目录下

### 图片设置

所有需要设置图片的都在这边, 这些是需要提前设置号然后写入配置文件的, 尽量全部填充好,有些功能不用的可以无视

### 首页定制

这个比较重要, 决定了页面所有的结构, 需要仔细设置

- **首页菜单**: 完全自由的设定, 可以自由添加
- **首页模块**: 预置了几种格式, 另外可以选择分类里面的类型
- **移动端菜单**: tab 栏的页面, 首页是一定会有的, 所以剩下的加上四种会比较好一点
- **移动端首页**: 预置了几种格式, 新番的话只会显示当天的
- **关于我们**: 文章别名, 点击跳转文章详情页, 很多地方用到, 很重要, 最好新建一篇文章放那介绍下网站

移动端默认页面有:

连载中的视频:/newAnimate<br />
连载中的漫画:/newComic<br />
全部视频:/allAnimate<br />
全部漫画:/allComic<br />
全部文章:/allPost<br />
商品:/shop<br />

### 视频定制

视频模块的设置, 基本上跟首页类似了, 默认页面有:

新番:/animate/new<br />
全部番剧:/animate/all<br />
类型分类:/animate/kind/分类 ID<br />
年份分类:/animate/year/分类 ID<br />
地区分类:/animate/area/分类 ID<br />
标签分类:/animate/tag/分类 ID<br />

#### 播放设置

- 等级限定则是表示不同的等级有着不同的播放来源, 功能很实用, 用不到的话则填写 0 级
- 用户等级大于或等于该等级时才会应用, 密钥和过期时间则是配合 nginx 的 secure link 的, 简单但也比较实用
- 如果视频端没有设置密钥或者过期时间, 那密钥跟过期时间这些都不会生效
- 解析的话则是根据正则匹配的, 多个正则命中时,会自动随机匹配一个

nginx secure link 设置示例如下:记得修改密钥, 然后放在 location /{} 里面即可

```apacheconf
secure_link      $arg_st,$arg_e;
secure_link_md5  KnB3uFomZTOL2nT1$uri$arg_e;
if ($secure_link = '') {
    return  402;
}
if ($secure_link = 0) {
    return  405;
}
```

#### 壁纸接口

主要是播放器的默认图, 想要写死的话就是不开启, 然后自己上传一张图片, 或者找个动漫接口获取

### 漫画定制

默认页面有:

连载:/comic/new<br />
全部:/comic/all<br />
类型分类:/comic/kind/分类 ID<br />
年份分类:/comic/year/分类 ID<br />
地区分类:/comic/area/分类 ID<br />
标签分类:/comic/tag/分类 ID<br />

### 文章定制

系统公告选一个分类, 然后里面的文章将会以公告的形式集成在用户中心

### 邮箱设置

- smtp 以及 sendgrid, 其他的方式暂不支持

## 工具

主要是一些小工具的集合, 后续可能会做成插件的形式发布, 每次尝试前建议保存下数据库, 没有经过彻底的测试
